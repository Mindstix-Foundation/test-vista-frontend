<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Report - TEST VISTA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .summary-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .question-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #dee2e6;
        }

        .question-card.correct {
            border-left-color: #28a745;
            background: linear-gradient(90deg, rgba(40, 167, 69, 0.05), white);
        }

        .question-card.incorrect {
            border-left-color: #dc3545;
            background: linear-gradient(90deg, rgba(220, 53, 69, 0.05), white);
        }

        .question-card.unanswered {
            border-left-color: #ffc107;
            background: linear-gradient(90deg, rgba(255, 193, 7, 0.05), white);
        }

        .question-number {
            background: #007bff;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 20px;
            color: #333;
        }

        .option-item {
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .option-user-incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .option-label {
            font-weight: bold;
            min-width: 25px;
        }

        .result-icon {
            font-size: 1.5rem;
            margin-left: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-correct { color: #28a745; }
        .stat-incorrect { color: #dc3545; }
        .stat-unanswered { color: #ffc107; }
        .stat-total { color: #007bff; }

        .back-button {
            background: linear-gradient(45deg, #6c757d, #495057);
            border: none;
            color: white;
            font-weight: 500;
            padding: 12px 24px;
            border-radius: 8px;
        }

        .back-button:hover {
            background: linear-gradient(45deg, #5a6268, #3d4142);
            color: white;
        }
    </style>
</head>

<body>
    <!-- Load Navbar -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="bi bi-file-text"></i> Detailed Report</h2>
                    <p class="mb-0" id="examTitle">Question-by-question analysis of your exam</p>
                </div>
                <button class="back-button" onclick="goBack()">
                    <i class="bi bi-arrow-left"></i> Back to Results
                </button>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number stat-total" id="totalQuestions">10</div>
                <div class="text-muted">Total Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-correct" id="correctCount">7</div>
                <div class="text-muted">Correct</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-incorrect" id="incorrectCount">2</div>
                <div class="text-muted">Incorrect</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-unanswered" id="unansweredCount">1</div>
                <div class="text-muted">Unanswered</div>
            </div>
        </div>

        <!-- Summary Card -->
        <div class="summary-card">
            <h4 class="mb-3"><i class="bi bi-graph-up"></i> Performance Summary</h4>
            <div class="row">
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-primary" id="finalScore">70%</h3>
                    <small class="text-muted">Final Score</small>
                </div>
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-info" id="totalMarks">70/100</h3>
                    <small class="text-muted">Marks Obtained</small>
                </div>
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-warning" id="timeTaken">45m 30s</h3>
                    <small class="text-muted">Total Time</small>
                </div>
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-success" id="accuracy">70%</h3>
                    <small class="text-muted">Accuracy</small>
                </div>
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-secondary" id="avgTime">1m 30s</h3>
                    <small class="text-muted">Avg per Question</small>
                </div>
                <div class="col-md-2 col-6 text-center">
                    <h3 class="text-dark" id="questionsAttempted">8/10</h3>
                    <small class="text-muted">Attempted</small>
                </div>
            </div>
        </div>

        <!-- Questions List -->
        <div class="row">
            <div class="col-12">
                <h4 class="mb-3"><i class="bi bi-list-ol"></i> Question Analysis</h4>
                <div id="questionsList">
                    <!-- Questions will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript files -->
    <script src="../commonPart/loadComponents.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Load Navbar -->
    <script>
        loadComponent('navbar', '../commonPart/navbar.html', 'navbar-container');

        // Get exam results from localStorage
        let examResult = {};
        let questions = [];
        let userAnswers = {};
        let questionTimeSpent = {};

        function loadExamData() {
            // Try to get exam result from localStorage
            const storedResult = localStorage.getItem('examResult');
            if (storedResult) {
                examResult = JSON.parse(storedResult);
                questions = examResult.questions || [];
                userAnswers = examResult.answers || {};
                questionTimeSpent = examResult.questionTimeSpent || {};
            } else {
                // Fallback to sample data if no stored result
                examResult = {
                    title: 'Sample Exam',
                    subject: 'General',
                    totalQuestions: 5,
                    correctAnswers: 3,
                    totalMarks: 100,
                    obtainedMarks: 60,
                    percentage: 60,
                    timeTaken: 1800 // 30 minutes in seconds
                };
                
                // Sample questions for demo
                questions = [
            {
                id: 1,
                        text: "What is the chemical symbol for Gold?",
                        options: ["Au", "Ag", "Go", "Gd"],
                        correct: 0
            },
            {
                id: 2,
                        text: "Which planet is known as the Red Planet?",
                        options: ["Venus", "Mars", "Jupiter", "Saturn"],
                        correct: 1
            },
            {
                id: 3,
                        text: "What is the square root of 144?",
                        options: ["10", "11", "12", "13"],
                        correct: 2
            },
            {
                id: 4,
                        text: "Who wrote 'Romeo and Juliet'?",
                        options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"],
                        correct: 1
            },
            {
                id: 5,
                        text: "What is the capital of Australia?",
                        options: ["Sydney", "Melbourne", "Canberra", "Perth"],
                        correct: 2
                    }
                ];
                
                userAnswers = { 0: 0, 1: 1, 3: 0 }; // Sample user answers
                questionTimeSpent = { 0: 45000, 1: 30000, 2: 60000, 3: 25000, 4: 40000 }; // Sample time data in milliseconds
            }
        }

        function updateSummary() {
            // Update page title
            document.getElementById('examTitle').textContent = `${examResult.title || 'Exam'} - Detailed Analysis`;
            
            // Calculate statistics
            const totalQuestions = questions.length;
            const answeredQuestions = Object.keys(userAnswers).length;
            const unansweredQuestions = totalQuestions - answeredQuestions;
            
            let correctCount = 0;
            let incorrectCount = 0;
            let totalQuestionTime = 0;
            let maxQuestionTime = 0;
            let minQuestionTime = Infinity;
            
            questions.forEach((question, index) => {
                if (userAnswers.hasOwnProperty(index)) {
                    if (userAnswers[index] === question.correct) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }
                
                // Calculate time statistics
                const timeSpent = questionTimeSpent[index] || 0;
                if (timeSpent > 0) {
                    totalQuestionTime += timeSpent;
                    maxQuestionTime = Math.max(maxQuestionTime, timeSpent);
                    if (minQuestionTime === Infinity) {
                        minQuestionTime = timeSpent;
                    } else {
                        minQuestionTime = Math.min(minQuestionTime, timeSpent);
                    }
                }
            });
            
            // Update statistics
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            document.getElementById('unansweredCount').textContent = unansweredQuestions;
            
            // Update summary
            document.getElementById('finalScore').textContent = (examResult.percentage || 0) + '%';
            document.getElementById('totalMarks').textContent = `${examResult.obtainedMarks || 0}/${examResult.totalMarks || 100}`;
            document.getElementById('accuracy').textContent = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) + '%' : '0%';
            
            // Format time taken
            const timeTaken = examResult.timeTaken || 0;
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('timeTaken').textContent = `${minutes}m ${seconds}s`;
            
            // Update average time per question
            const avgTimeElement = document.getElementById('avgTime');
            if (avgTimeElement && totalQuestionTime > 0) {
                const avgTime = totalQuestionTime / Object.keys(questionTimeSpent).length;
                avgTimeElement.textContent = formatTime(avgTime);
            }
            
            // Update questions attempted
            const attemptedElement = document.getElementById('questionsAttempted');
            if (attemptedElement) {
                attemptedElement.textContent = `${answeredQuestions}/${totalQuestions}`;
            }
        }

        function formatTime(milliseconds) {
            if (!milliseconds || milliseconds === 0) return '0s';
            
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            } else {
                return `${seconds}s`;
            }
        }

        function displayQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = '';

            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correct;
                const isAnswered = userAnswers.hasOwnProperty(index);
                const timeSpent = questionTimeSpent[index] || 0;
                
                let cardClass = 'question-card';
                let statusIcon = '';
                let statusText = '';
                
                if (!isAnswered) {
                    cardClass += ' unanswered';
                    statusIcon = '<i class="bi bi-dash-circle text-warning"></i>';
                    statusText = 'Not Answered';
                } else if (isCorrect) {
                    cardClass += ' correct';
                    statusIcon = '<i class="bi bi-check-circle text-success"></i>';
                    statusText = 'Correct';
                } else {
                    cardClass += ' incorrect';
                    statusIcon = '<i class="bi bi-x-circle text-danger"></i>';
                    statusText = 'Incorrect';
                }

                const questionCard = document.createElement('div');
                questionCard.className = cardClass;
                
                let optionsHtml = '';
                question.options.forEach((option, optionIndex) => {
                    let optionClass = 'option-item';
                    let optionIcon = '';
                    
                    if (optionIndex === question.correct) {
                        optionClass += ' option-correct';
                        optionIcon = '<i class="bi bi-check-circle text-success"></i>';
                    } else if (isAnswered && optionIndex === userAnswer && !isCorrect) {
                        optionClass += ' option-user-incorrect';
                        optionIcon = '<i class="bi bi-x-circle text-danger"></i>';
                    }
                    
                    optionsHtml += `
                        <div class="${optionClass}">
                            <span class="option-label">${String.fromCharCode(65 + optionIndex)}.</span>
                            <span class="flex-grow-1">${option}</span>
                            <span class="result-icon">${optionIcon}</span>
                        </div>
                    `;
                });

                questionCard.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="question-number">${index + 1}</div>
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center gap-2">
                                <i class="bi bi-clock text-info"></i>
                                <span class="fw-bold text-info">${formatTime(timeSpent)}</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                ${statusIcon}
                                <span class="fw-bold">${statusText}</span>
                            </div>
                        </div>
                    </div>
                    <div class="question-text">${question.text}</div>
                    <div class="options-container">
                        ${optionsHtml}
                    </div>
                    ${!isAnswered ? '<div class="alert alert-warning mt-3 mb-0"><i class="bi bi-exclamation-triangle"></i> This question was not answered.</div>' : ''}
                `;
                
                container.appendChild(questionCard);
            });
        }

        function goBack() {
            // Go back to result page with current parameters
            const urlParams = new URLSearchParams(window.location.search);
            window.location.href = `../exam_pages/result.html?${urlParams.toString()}`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadExamData();
            updateSummary();
            displayQuestions();
        });
    </script>
</body>

</html> 